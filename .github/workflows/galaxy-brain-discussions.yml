name: ğŸ§  Galaxy Brain - Discussion Creator
on:
  schedule:
    - cron: '0 10 * * 2,4,6'  # TerÃ§a, Quinta e SÃ¡bado Ã s 10h
  workflow_dispatch:
    inputs:
      discussion_type:
        description: 'Type of discussion to create'
        required: false
        default: 'idea'
        type: choice
        options:
          - idea
          - qa
          - announcement
          - planning

jobs:
  create-discussions:
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ§  Create Discussion for Galaxy Brain Badge
      uses: actions/github-script@v7
      with:
        script: |
          const discussionType = '${{ github.event.inputs.discussion_type }}';
          
          const discussions = {
            idea: {
              title: 'ğŸ’¡ [IDEA] Automated Badge Tracking System',
              body: `## ğŸ’¡ Nova Ideia para Badge Tracking

### ğŸ¯ Objetivo
Criar um sistema automatizado para rastrear o progresso das insÃ­gnias do GitHub em tempo real.

### ğŸ”§ Funcionalidades Propostas
- [ ] Dashboard interativo com progresso das badges
- [ ] NotificaÃ§Ãµes automÃ¡ticas quando badges sÃ£o conquistadas
- [ ] AnÃ¡lise preditiva de prÃ³ximas badges a conquistar
- [ ] IntegraÃ§Ã£o com GitHub API para dados em tempo real

### ğŸš€ BenefÃ­cios
- Melhor visibilidade do progresso
- MotivaÃ§Ã£o contÃ­nua
- EstratÃ©gias otimizadas para conquista de badges

### ğŸ’­ DiscussÃ£o
O que vocÃªs acham dessa ideia? Alguma sugestÃ£o de melhoria?

---
*DiscussÃ£o criada automaticamente para Galaxy Brain badge*`,
              category: 'Ideas'
            },
            qa: {
              title: 'ğŸ™‹ [Q&A] Melhores EstratÃ©gias para GitHub Badges',
              body: `## ğŸ™‹ Perguntas sobre GitHub Badges

### â“ Perguntas para a Comunidade

1. **Qual badge vocÃªs acham mais difÃ­cil de conquistar?**
   - Pull Shark
   - Galaxy Brain
   - DevOps Guru
   - Outras?

2. **Quais estratÃ©gias funcionaram melhor para vocÃªs?**
   - Projetos pessoais
   - ContribuiÃ§Ãµes open source
   - AutomaÃ§Ãµes
   - ColaboraÃ§Ãµes

3. **Como vocÃªs organizam o processo de conquista de badges?**
   - Planejamento semanal
   - Foco em uma badge por vez
   - EstratÃ©gia paralela
   - Outras abordagens?

### ğŸ’¡ Compartilhem suas experiÃªncias!
Vamos trocar ideias e aprender juntos!

---
*DiscussÃ£o criada automaticamente para Galaxy Brain badge*`,
              category: 'Q&A'
            },
            announcement: {
              title: 'ğŸ“¢ [ANNOUNCEMENT] Badge Progress Update',
              body: `## ğŸ“¢ AtualizaÃ§Ã£o de Progresso das Badges

### ğŸ† Status Atual
- âœ… Pull Shark: Conquistado!
- âœ… Pair Extraordinaire: Conquistado!
- âœ… DevOps Guru: Conquistado!
- âœ… Quickdraw: Conquistado!
- ğŸ”„ Galaxy Brain: Em progresso
- ğŸ”„ Heart On Your Sleeve: Em progresso
- ğŸ”„ YOLO: Em progresso

### ğŸ¯ PrÃ³ximos Objetivos
1. **Galaxy Brain**: Participar ativamente em discussÃµes
2. **Heart On Your Sleeve**: Adicionar reaÃ§Ãµes em issues/PRs
3. **YOLO**: Fazer merges diretos (com cuidado!)

### ğŸš€ Novidades
- Sistema de monitoramento automatizado implementado
- Workflows otimizados para cada badge
- DocumentaÃ§Ã£o completa disponÃ­vel

### ğŸ’¬ Feedback
Como vocÃªs estÃ£o se saindo com suas badges? Compartilhem suas conquistas!

---
*AnÃºncio criado automaticamente para Galaxy Brain badge*`,
              category: 'Announcements'
            },
            planning: {
              title: 'ğŸ¯ [PLANNING] EstratÃ©gia Semanal de Badges',
              body: `## ğŸ¯ Planejamento Semanal de Badges

### ğŸ“… Esta Semana (${new Date().toLocaleDateString()})

#### ğŸ¯ Objetivos Principais
- [ ] **Galaxy Brain**: Criar 3 discussÃµes e participar ativamente
- [ ] **Heart On Your Sleeve**: Adicionar reaÃ§Ãµes em 10+ issues/PRs
- [ ] **YOLO**: Fazer 2 merges diretos (com testes adequados)

#### ğŸ“Š MÃ©tricas de Sucesso
- DiscussÃµes criadas: 0/3
- ReaÃ§Ãµes adicionadas: 0/10
- Merges diretos: 0/2

#### ğŸ”§ Tarefas TÃ©cnicas
- [ ] Otimizar workflows de automaÃ§Ã£o
- [ ] Melhorar sistema de monitoramento
- [ ] Documentar estratÃ©gias bem-sucedidas

### ğŸ¤ ColaboraÃ§Ã£o
Precisamos de ajuda com alguma badge especÃ­fica? Vamos trabalhar juntos!

---
*Planejamento criado automaticamente para Galaxy Brain badge*`,
              category: 'Project Planning'
            }
          };
          
          const selectedDiscussion = discussions[discussionType];
          
          try {
            // First, get the repository ID and discussion categories
            const repoResponse = await github.rest.repos.get({
              owner: context.repo.owner,
              repo: context.repo.repo
            });
            
            const categoriesResponse = await github.rest.graphql(`
              query($owner: String!, $repo: String!) {
                repository(owner: $owner, name: $repo) {
                  discussionCategories(first: 10) {
                    nodes {
                      id
                      name
                    }
                  }
                }
              }
            `, {
              owner: context.repo.owner,
              repo: context.repo.repo
            });
            
            const categories = categoriesResponse.data.repository.discussionCategories.nodes;
            let categoryId = null;
            
            // Find the appropriate category
            for (const category of categories) {
              if (category.name.toLowerCase().includes(selectedDiscussion.category.toLowerCase()) ||
                  selectedDiscussion.category.toLowerCase().includes(category.name.toLowerCase())) {
                categoryId = category.id;
                break;
              }
            }
            
            // If no specific category found, use the first available
            if (!categoryId && categories.length > 0) {
              categoryId = categories[0].id;
            }
            
            if (categoryId) {
              // Create the discussion using GraphQL
              const createDiscussionResponse = await github.rest.graphql(`
                mutation($input: CreateDiscussionInput!) {
                  createDiscussion(input: $input) {
                    discussion {
                      id
                      url
                      title
                    }
                  }
                }
              `, {
                input: {
                  repositoryId: repoResponse.data.node_id,
                  categoryId: categoryId,
                  title: selectedDiscussion.title,
                  body: selectedDiscussion.body
                }
              });
              
              const discussion = createDiscussionResponse.data.createDiscussion.discussion;
              console.log(`âœ… Created discussion: ${discussion.title}`);
              console.log(`ğŸ”— URL: ${discussion.url}`);
              
              // Add a comment to the discussion for more engagement
              await github.rest.graphql(`
                mutation($input: AddDiscussionCommentInput!) {
                  addDiscussionComment(input: $input) {
                    comment {
                      id
                      url
                    }
                  }
                }
              `, {
                input: {
                  discussionId: discussion.id,
                  body: `ğŸ‰ **DiscussÃ£o criada com sucesso!**
                  
Esta discussÃ£o foi criada automaticamente como parte da estratÃ©gia para conquistar a **Galaxy Brain** badge.

### ğŸ§  Sobre a Galaxy Brain Badge
- **Requisito**: Participar ativamente em discussÃµes
- **EstratÃ©gia**: Criar discussÃµes relevantes e engajar com a comunidade
- **Status**: Em progresso

Vamos manter essa discussÃ£o ativa! ğŸ’¬`
                }
              });
              
              console.log(`ğŸ’¬ Added engagement comment to discussion`);
              
            } else {
              console.log('âš ï¸ No discussion categories found. Discussions might not be enabled for this repository.');
            }
            
          } catch (error) {
            console.log('âš ï¸ Error creating discussion:', error.message);
            console.log('ğŸ’¡ Make sure discussions are enabled in repository settings');
          }
          
          console.log(`ğŸ§  Galaxy Brain badge strategy: Discussion created successfully!`);
          
    - name: ğŸ¯ Badge Achievement Notification
      run: |
        echo "ğŸ§  Galaxy Brain badge requirements:"
        echo "âœ… Created discussion with relevant content"
        echo "âœ… Added engagement comment"
        echo "âœ… Used proper discussion categories"
        echo "ğŸ† Galaxy Brain badge should be achieved with active participation!" 